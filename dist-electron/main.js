"use strict";var x=Object.create;var v=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var N=(a,e,t)=>e in a?v(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var Q=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of q(e))!z.call(a,s)&&s!==t&&v(a,s,{get:()=>e[s],enumerable:!(n=T(e,s))||n.enumerable});return a};var C=(a,e,t)=>(t=a!=null?x(J(a)):{},Q(e||!a||!a.__esModule?v(t,"default",{value:a,enumerable:!0}):t,a));var c=(a,e,t)=>N(a,typeof e!="symbol"?e+"":e,t);const l=require("electron"),m=require("path"),y=require("fs"),A=require("whatsapp-web.js"),O=require("qrcode-terminal");function V(a){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const t in a)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(a,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>a[t]})}}return e.default=a,Object.freeze(e)}const H=V(O);class ${constructor(e){c(this,"client",null);c(this,"mainWindow",null);c(this,"status","disconnected");c(this,"messageReceiverWorker",null);c(this,"fileCache",new Map);this.mainWindow=e,this.initializeClient()}setMessageReceiverWorker(e){this.messageReceiverWorker=e}getChromiumExecutablePath(){if(!l.app.isPackaged)return;const e=m.join(process.resourcesPath,"app.asar.unpacked","node_modules","whatsapp-web.js","node_modules","puppeteer-core",".local-chromium","win64-1045629","chrome-win","chrome.exe");if(console.log("[WhatsAppManager] Checking Chromium path:",e),y.existsSync(e))return console.log("[WhatsAppManager] Chromium found at:",e),e;console.error("[WhatsAppManager] Chromium not found at expected path:",e)}initializeClient(){try{console.log("[WhatsAppManager] Initializing client...");const e=this.getChromiumExecutablePath(),t={headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--no-zygote","--disable-gpu"]};e&&(t.executablePath=e),console.log("[WhatsAppManager] Puppeteer config:",JSON.stringify(t,null,2)),this.client=new A.Client({authStrategy:new A.LocalAuth({dataPath:l.app.isPackaged?m.join(l.app.getPath("userData"),".wwebjs_auth"):".wwebjs_auth"}),puppeteer:t,webVersionCache:{type:"remote",remotePath:"https://raw.githubusercontent.com/AntoniaSaGe/AntoniaSaGe/main/whatsapp-web-version"}}),this.setupEventHandlers()}catch(e){console.error("[WhatsAppManager] Error initializing client:",e),this.status="disconnected",this.broadcastStatus("disconnected")}}setupEventHandlers(){this.client&&(this.client.on("qr",e=>{console.log("[WhatsAppManager] QR Code received"),H.generate(e,{small:!0}),this.mainWindow&&this.mainWindow.webContents.send("whatsapp:qr-code",e),this.status="connecting",this.broadcastStatus("connecting")}),this.client.on("ready",()=>{console.log("[WhatsAppManager] Client is ready!"),this.status="ready",this.broadcastStatus("ready")}),this.client.on("authenticated",()=>{console.log("[WhatsAppManager] Client authenticated"),setTimeout(()=>{this.status!=="ready"&&(console.log("[WhatsAppManager] Fallback: Setting status to ready after authentication"),this.status="ready",this.broadcastStatus("ready"))},5e3)}),this.client.on("auth_failure",e=>{console.error("[WhatsAppManager] Authentication failed:",e),this.status="disconnected",this.broadcastStatus("disconnected"),this.mainWindow&&this.mainWindow.webContents.send("whatsapp:error",{type:"auth_failure",message:"Authentication failed. Please try again."})}),this.client.on("disconnected",e=>{console.log("[WhatsAppManager] Client disconnected:",e),this.status="disconnected",this.broadcastStatus("disconnected")}),this.client.on("loading_screen",(e,t)=>{console.log(`[WhatsAppManager] Loading... ${e}% - ${t}`)}),this.client.on("message",async e=>{console.log("[WhatsAppManager] Message received:",e.from),this.messageReceiverWorker?await this.messageReceiverWorker.handleIncomingMessage(e):this.mainWindow&&this.mainWindow.webContents.send("whatsapp:message-received",{id:e.id._serialized,from:e.from,to:e.to,body:e.body,type:e.type,timestamp:e.timestamp,hasMedia:e.hasMedia})}))}async connect(){try{if(console.log("[WhatsAppManager] Connecting..."),!this.client)throw new Error("Client not initialized");return this.status==="ready"?(console.log("[WhatsAppManager] Already connected"),!0):(this.status="connecting",this.broadcastStatus("connecting"),await this.client.initialize(),!0)}catch(e){throw console.error("[WhatsAppManager] Connection error:",e),this.status="disconnected",this.broadcastStatus("disconnected"),this.mainWindow&&this.mainWindow.webContents.send("whatsapp:error",{type:"connection_error",message:e instanceof Error?e.message:"Unknown connection error"}),e}}async disconnect(){try{console.log("[WhatsAppManager] Disconnecting..."),this.client&&(await this.client.destroy(),this.client=null),this.status="disconnected",this.broadcastStatus("disconnected"),this.clearFileCache(),this.initializeClient()}catch(e){throw console.error("[WhatsAppManager] Disconnect error:",e),this.status="disconnected",this.broadcastStatus("disconnected"),e}}formatPhoneNumber(e){let t=e.replace(/\D/g,"");return t.startsWith("0")&&(t="62"+t.slice(1)),t.endsWith("@c.us")||(t+="@c.us"),t}async downloadFile(e,t=3){const n=this.fileCache.get(e);if(n&&y.existsSync(n))return console.log(`[WhatsAppManager] Using cached file for: ${e}`),n;for(let s=0;s<t;s++)try{const r=await this._downloadFileInternal(e);return this.fileCache.set(e,r),console.log(`[WhatsAppManager] File cached for URL: ${e}`),r}catch(r){if(console.warn(`[WhatsAppManager] Download attempt ${s+1}/${t} failed:`,r),s===t-1)throw r;await new Promise(o=>setTimeout(o,Math.pow(2,s)*1e3))}throw new Error(`Failed to download file after ${t} attempts`)}async _downloadFileInternal(e){const t=await import("https"),n=await import("http"),s=await import("fs"),r=await import("path"),o=await import("os");return new Promise((h,d)=>{try{const i=o.tmpdir(),w=`whatsapp_media_${Date.now()}_${r.basename(e).split("?")[0]}`,p=r.join(i,w);console.log(`[WhatsAppManager] Downloading to: ${p}`);const W=e.startsWith("https://")?t:n,P=s.createWriteStream(p);W.get(e,b=>{if(b.statusCode!==200){d(new Error(`Failed to download file: HTTP ${b.statusCode}`));return}b.pipe(P),P.on("finish",()=>{P.close(),console.log(`[WhatsAppManager] Download complete: ${p}`),h(p)}),P.on("error",L=>{s.unlink(p,()=>{}),d(L)})}).on("error",b=>{s.unlink(p,()=>{}),d(b)})}catch(i){d(i)}})}clearFileCache(){console.log(`[WhatsAppManager] Clearing file cache (${this.fileCache.size} files)`);for(const[,e]of this.fileCache.entries())try{y.existsSync(e)&&(y.unlinkSync(e),console.log(`[WhatsAppManager] Deleted cached file: ${e}`))}catch(t){console.warn(`[WhatsAppManager] Failed to delete cached file: ${e}`,t)}this.fileCache.clear()}async sendMessage(e,t){try{if(!this.client||this.status!=="ready")throw new Error("WhatsApp client is not ready");const n=this.formatPhoneNumber(e);if(console.log(`[WhatsAppManager] Sending message to ${e} (formatted: ${n})`),!await this.client.isRegisteredUser(n))throw console.warn(`[WhatsAppManager] User ${e} is not registered on WhatsApp.`),new Error(`User ${e} is not registered on WhatsApp`);return await this.client.sendMessage(n,t),console.log(`[WhatsAppManager] Message sent successfully to ${e}`),!0}catch(n){throw console.error("[WhatsAppManager] Send message error:",n),n}}async sendMessageWithMedia(e,t,n){try{if(!this.client||this.status!=="ready")throw new Error("WhatsApp client is not ready");const s=this.formatPhoneNumber(e);if(console.log(`[WhatsAppManager] Sending media message to ${e} (formatted: ${s})`),!await this.client.isRegisteredUser(s))throw console.warn(`[WhatsAppManager] User ${e} is not registered on WhatsApp.`),new Error(`User ${e} is not registered on WhatsApp`);let o,h;return n.startsWith("http://")||n.startsWith("https://")?(console.log(`[WhatsAppManager] Downloading remote file: ${n}`),h=await this.downloadFile(n),o=A.MessageMedia.fromFilePath(h)):(h=n,o=A.MessageMedia.fromFilePath(n)),await this.client.sendMessage(s,o,{caption:t}),console.log(`[WhatsAppManager] Media message sent successfully to ${e}`),!0}catch(s){throw console.error("[WhatsAppManager] Send media message error:",s),s}}getStatus(){return this.status}isReady(){return this.status==="ready"&&this.client!==null}broadcastStatus(e){this.mainWindow&&!this.mainWindow.isDestroyed()&&this.mainWindow.webContents.send("whatsapp:status-change",e)}async getClientInfo(){try{if(!this.client||this.status!=="ready")return null;const e=this.client.info;return{wid:e.wid._serialized,pushname:e.pushname,platform:e.platform}}catch(e){return console.error("[WhatsAppManager] Get client info error:",e),null}}}class F{constructor(e,t){c(this,"whatsappManager");c(this,"mainWindow");c(this,"isProcessing",!1);c(this,"isPaused",!1);c(this,"currentJob",null);this.whatsappManager=e,this.mainWindow=t}getCurrentJob(){return this.currentJob}async processJob(e){var d;if(console.log("[MessageProcessor] Received job template:",JSON.stringify(e.template,null,2)),!e.template)throw new Error("Template is required for job processing");const t=e.template.content&&e.template.content.trim().length>0,n=Array.isArray(e.template.variants)&&e.template.variants.length>0;if(console.log(`[MessageProcessor] Template check - hasContent: ${t}, hasVariants: ${n}`),!t&&!n)throw console.error("[MessageProcessor] Template validation failed:",{content:e.template.content,variants:e.template.variants,templateKeys:Object.keys(e.template)}),new Error(`Template must have content or variants defined. Received: content=${e.template.content}, variants=${JSON.stringify(e.template.variants)}`);if(this.isProcessing)throw new Error("Already processing a job");this.isProcessing=!0,this.currentJob=e,this.isPaused=!1,console.log(`[MessageProcessor] Starting job ${e.jobId} with ${e.contacts.length} contacts`);let s=0,r=0,o=0;const h=[];this.reportProgress(e.jobId,s,e.contacts.length,r,o,"processing");for(const i of e.contacts){if(this.isPaused&&(this.reportProgress(e.jobId,s,e.contacts.length,r,o,"paused"),await this.waitForResume(),this.reportProgress(e.jobId,s,e.contacts.length,r,o,"processing")),!this.isProcessing)break;try{let p=e.template.content||"";if(e.template.variants&&e.template.variants.length>0){const P=Math.floor(Math.random()*e.template.variants.length);p=e.template.variants[P]}const W=this.formatMessage(p,i);console.log(`[MessageProcessor] Template has ${((d=e.template.variants)==null?void 0:d.length)||0} variants`),console.log(`[MessageProcessor] Selected template content: "${p}"`),console.log(`[MessageProcessor] Formatted message: "${W}"`),console.log(`[MessageProcessor] Has assets: ${e.assets&&e.assets.length>0}`),e.assets&&e.assets.length>0?await this.whatsappManager.sendMessageWithMedia(i.phone,W,e.assets[0]):await this.whatsappManager.sendMessage(i.phone,W),h.push({id:crypto.randomUUID(),activity_log_id:e.jobId,contact_id:i.id||"",contact_name:i.name||i.contact_name||"Unknown Contact",contact_phone:i.phone||i.contact_phone||"Unknown Phone",content:W,status:"sent",sent_at:new Date().toISOString()}),r++}catch(p){console.error(`[MessageProcessor] Failed to send to ${i.phone}:`,p),h.push({id:crypto.randomUUID(),activity_log_id:e.jobId,contact_id:i.id||"",contact_name:i.name||i.contact_name||"Unknown Contact",contact_phone:i.phone||i.contact_phone||"Unknown Phone",status:"failed",sent_at:new Date().toISOString(),error_message:p instanceof Error?p.message:String(p)}),this.mainWindow&&this.mainWindow.webContents.send("whatsapp:job-error-detail",{jobId:e.jobId,phone:i.phone,error:p instanceof Error?p.message:String(p)}),o++}s++,this.reportProgress(e.jobId,s,e.contacts.length,r,o,"processing");const w=this.calculateDelayFromConfig(e.delayConfig);await this.delay(w)}this.isProcessing=!1,this.currentJob=null,this.reportProgress(e.jobId,s,e.contacts.length,r,o,"completed",{logs:h}),console.log(`[MessageProcessor] Job ${e.jobId} completed`)}pause(){return this.isProcessing&&!this.isPaused?(this.isPaused=!0,console.log("[MessageProcessor] Job paused"),!0):!1}resume(){return this.isProcessing&&this.isPaused?(this.isPaused=!1,console.log("[MessageProcessor] Job resumed"),!0):!1}stop(){return this.isProcessing?(this.isProcessing=!1,this.isPaused=!1,this.currentJob=null,console.log("[MessageProcessor] Job stopped"),!0):!1}formatMessage(e,t){let n=e;n=n.replace(/{{name}}/g,t.name||""),n=n.replace(/{{phone}}/g,t.phone||"");const s=n.match(/{{(.*?)}}/g);return s&&s.forEach(r=>{const o=r.replace(/{{|}}/g,"");t[o]!==void 0&&(n=n.replace(new RegExp(r,"g"),String(t[o])))}),n}reportProgress(e,t,n,s,r,o,h){this.mainWindow&&this.mainWindow.webContents.send("whatsapp:job-progress",{jobId:e,processed:t,total:n,success:s,failed:r,status:o,metadata:h})}calculateDelayFromConfig(e){if(!e||!e.delayRange||e.delayRange.length===0)return console.warn("[MessageProcessor] No valid delayConfig provided, using default values"),2e3+Math.random()*3e3;if(e.delayRange.length<1)return console.warn("[MessageProcessor] Invalid delayRange, using default values"),2e3+Math.random()*3e3;const s=e.delayRange[0]*1e3;let r=s;return e.mode==="dynamic"&&e.delayRange.length>=2?(r=e.delayRange[1]*1e3,r<=s?(console.warn("[MessageProcessor] Invalid delay range (max <= min), using static mode"),s):s+Math.random()*(r-s)):s}delay(e){return new Promise(t=>setTimeout(t,e))}waitForResume(){return new Promise(e=>{const t=setInterval(()=>{this.isPaused||(clearInterval(t),e())},500)})}}class U{constructor(e){c(this,"queue",[]);c(this,"isRunning",!1);c(this,"messageProcessor");this.messageProcessor=e}async addToQueue(e){console.log(`[QueueWorker] Adding job ${e.jobId} to queue`),this.queue.push(e),this.processQueue()}async processQueue(){if(!this.isRunning){for(this.isRunning=!0,console.log("[QueueWorker] Starting queue processing");this.queue.length>0;){const e=this.queue.shift();if(e)try{console.log(`[QueueWorker] Processing job ${e.jobId}`),await this.messageProcessor.processJob(e)}catch(t){console.error(`[QueueWorker] Error processing job ${e.jobId}:`,t)}}this.isRunning=!1,console.log("[QueueWorker] Queue processing finished")}}getQueueLength(){return this.queue.length}}let u=null,f=null,_=null;const j=(a,e,t,n)=>{console.log("[IPC] Setting up IPC handlers..."),e?u=e:(console.log("[IPC] Creating new WhatsAppManager (Fallback)"),u=new $(a)),t?f=t:(console.log("[IPC] Creating new MessageProcessor (Fallback)"),f=new F(u,a)),n?_=n:f&&(console.log("[IPC] Creating new QueueWorker (Fallback)"),_=new U(f)),l.ipcMain.handle("whatsapp:connect",async()=>{try{if(console.log("[IPC] whatsapp:connect called"),!u)throw new Error("WhatsAppManager not initialized");return{success:!0,connected:await u.connect()}}catch(s){return console.error("[IPC] whatsapp:connect error:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}),l.ipcMain.handle("whatsapp:disconnect",async()=>{try{if(console.log("[IPC] whatsapp:disconnect called"),!u)throw new Error("WhatsAppManager not initialized");return await u.disconnect(),{success:!0}}catch(s){return console.error("[IPC] whatsapp:disconnect error:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}),l.ipcMain.handle("whatsapp:send-message",async(s,{to:r,content:o,assets:h})=>{try{if(console.log(`[IPC] whatsapp:send-message called for ${r}`),!u)throw new Error("WhatsAppManager not initialized");let d;return h&&h.length>0?d=await u.sendMessageWithMedia(r,o,h[0]):d=await u.sendMessage(r,o),{success:d}}catch(d){return console.error("[IPC] whatsapp:send-message error:",d),{success:!1,error:d instanceof Error?d.message:"Unknown error"}}}),l.ipcMain.handle("whatsapp:get-status",async()=>{try{if(!u)return{status:"disconnected",ready:!1};const s=u.getStatus(),r=u.isReady();return{status:s,ready:r}}catch(s){return console.error("[IPC] whatsapp:get-status error:",s),{status:"disconnected",ready:!1}}}),l.ipcMain.handle("whatsapp:get-client-info",async()=>{try{return console.log("[IPC] whatsapp:get-client-info called"),u?await u.getClientInfo():null}catch(s){return console.error("[IPC] whatsapp:get-client-info error:",s),null}}),l.ipcMain.handle("whatsapp:process-job",async(s,{jobId:r,contacts:o,template:h,assets:d,delayConfig:i})=>{try{if(console.log(`[IPC] whatsapp:process-job called for job ${r}`),!u||!u.isReady())throw new Error("WhatsApp is not ready");if(_)console.log(`[IPC] Adding job ${r} to queue`),_.addToQueue({jobId:r,contacts:o,template:h,assets:d,delayConfig:i}).catch(w=>{console.error("[IPC] Error adding to queue:",w)});else if(f)console.warn("[IPC] QueueWorker not available, processing directly"),f.processJob({jobId:r,contacts:o,template:h,assets:d,delayConfig:i}).catch(w=>{console.error("[IPC] Job processing error:",w)});else throw new Error("MessageProcessor not initialized");return{success:!0,message:"Job started",jobId:r}}catch(w){return console.error("[IPC] whatsapp:process-job error:",w),{success:!1,error:w instanceof Error?w.message:"Unknown error"}}}),l.ipcMain.handle("whatsapp:pause-job",async(s,{jobId:r})=>{if(console.log(`[IPC] whatsapp:pause-job called for job ${r}`),f){const o=f.pause();return{success:o,message:o?"Job paused":"Failed to pause"}}return{success:!1,message:"Processor not ready"}}),l.ipcMain.handle("whatsapp:resume-job",async(s,{jobId:r})=>{if(console.log(`[IPC] whatsapp:resume-job called for job ${r}`),f){const o=f.resume();return{success:o,message:o?"Job resumed":"Failed to resume"}}return{success:!1,message:"Processor not ready"}}),console.log("[IPC] IPC handlers setup complete")};class Y{constructor(e,t){c(this,"whatsappManager");c(this,"mainWindow");c(this,"checkInterval",null);c(this,"CHECK_INTERVAL_MS",18e4);this.whatsappManager=e,this.mainWindow=t}startMonitoring(){this.checkInterval||(console.log("[StatusWorker] Starting status monitoring"),this.checkHealth(),this.checkInterval=setInterval(async()=>{await this.checkHealth()},this.CHECK_INTERVAL_MS))}stopMonitoring(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null,console.log("[StatusWorker] Stopped status monitoring"))}async checkHealth(){const e=this.whatsappManager.getStatus();if(console.log(`[StatusWorker] Health check: ${e}`),this.mainWindow&&!this.mainWindow.isDestroyed()&&this.mainWindow.webContents.send("whatsapp:status-change",e),e==="disconnected"){console.log("[StatusWorker] Detected disconnection, attempting reconnect...");try{await this.whatsappManager.connect()}catch(t){console.error("[StatusWorker] Reconnect failed:",t)}}}}class K{constructor(e,t){c(this,"mainWindow");c(this,"unsubscribeKeywords",["unsubscribe","stop","batal","berhenti","jangan kirim","keluar","cancel"]);this.mainWindow=t}async handleIncomingMessage(e){try{console.log("[MessageReceiverWorker] Processing incoming message from:",e.from);const t=this.isUnsubscribeRequest(e.body);t&&(console.log("[MessageReceiverWorker] Unsubscribe request detected from:",e.from),this.mainWindow&&!this.mainWindow.isDestroyed()&&this.mainWindow.webContents.send("whatsapp:unsubscribe-detected",{phoneNumber:e.from,message:e.body,timestamp:new Date().toISOString()})),this.mainWindow&&!this.mainWindow.isDestroyed()&&this.mainWindow.webContents.send("whatsapp:message-received",{id:e.id._serialized,from:e.from,to:e.to,body:e.body,type:e.type,timestamp:e.timestamp,hasMedia:e.hasMedia,isUnsubscribeRequest:t})}catch(t){console.error("[MessageReceiverWorker] Error handling message:",t)}}isUnsubscribeRequest(e){if(!e)return!1;const t=e.toLowerCase();return this.unsubscribeKeywords.some(n=>t.includes(n))}}async function E(a){try{return await y.promises.access(a,y.constants.F_OK|y.constants.R_OK),!0}catch(e){return console.debug(`[Main] File does not exist or is not accessible: ${a}`,e),!1}}let g=null,M=null,k=null,S=null,I=null,R=null;const D=async()=>{let a;try{if(process.env.VITE_DEV_SERVER_URL){const e=m.join("C:","Users","andry","AnotherProjectCode","Server","XalesIn-Whatsapp","xenderin","public","icon.png");console.log("[Main] Development mode - trying icon path:",e),await E(e)?a=e:(console.warn("[Main] Development icon not found, falling back to default"),a=void 0)}else{const e=m.join("C:","Users","andry","AnotherProjectCode","Server","XalesIn-Whatsapp","xenderin","public","icon.ico");if(console.log("[Main] Production mode - trying icon path:",e),await E(e))a=e;else{const n=m.join("C:","Users","andry","AnotherProjectCode","Server","XalesIn-Whatsapp","xenderin","public","icon.ico");console.log("[Main] Fallback icon path:",n),a=await E(n)?n:void 0}}}catch(e){console.error("[Main] Error determining icon path:",e),a=void 0}try{if(g=new l.BrowserWindow({width:1200,height:800,autoHideMenuBar:!0,icon:a,webPreferences:{preload:m.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0,webSecurity:!0}}),g.webContents.on("before-input-event",(e,t)=>{t.alt&&e.preventDefault()}),process.platform==="win32"&&a)try{g.setIcon(a)}catch(e){console.error("[Main] Failed to set window icon:",e)}}catch(e){console.error("[Main] Failed to create browser window:",e),g=new l.BrowserWindow({width:1200,height:800,autoHideMenuBar:!0,webPreferences:{preload:m.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0,webSecurity:!0}}),g.webContents.on("before-input-event",(t,n)=>{n.alt&&t.preventDefault()})}if(console.log("[Main] Initializing workers..."),M=new $(g),k=new F(M,g),S=new U(k),I=new Y(M,g),R=new K(M,g),M.setMessageReceiverWorker(R),I.startMonitoring(),j(g,M,k,S),process.env.VITE_DEV_SERVER_URL)g.loadURL(process.env.VITE_DEV_SERVER_URL);else{const e=m.join(l.app.getAppPath(),"dist","index.html");console.log("[Main] Loading from:",e),g.loadFile(e)}g.webContents.on("before-input-event",(e,t)=>{(t.key==="F5"||t.control&&t.key==="r")&&e.preventDefault()}),g.webContents.on("did-fail-load",(e,t,n)=>{console.error("[Main] Failed to load:",t,n)}),g.webContents.on("crashed",(e,t)=>{console.error("[Main] Renderer crashed:",t)})};l.app.whenReady().then(async()=>{await D(),l.app.on("activate",()=>{l.BrowserWindow.getAllWindows().length===0&&D().catch(a=>{console.error("[Main] Error in activate handler:",a)})})});l.app.on("window-all-closed",()=>{I&&I.stopMonitoring(),M&&M.disconnect(),process.platform!=="darwin"&&l.app.quit()});
